<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="format-detection" content="telephone=no,date=no,address=no,email=no"/>
  <meta name="robots" content="noindex,nofollow"/>
  <title>Rewind Äá»‘i tÃ¡c TÃ i xáº¿ 2025</title>
  <style>
    :root{
      /* Light theme (Mex-style) */
      --bg0:#D9FCDE;  /* Softest green */
      --bg1:#EBFAFF;  /* Softest blue */
      --bg2:#FBF0FF;  /* Softest purple */
      --card:rgba(255,255,255,.92);
      --card2:rgba(255,255,255,.78);
      --text:#184440;   /* deep green/ink */
      --muted:rgba(24,68,64,.74);
      --muted2:rgba(24,68,64,.58);
      --line:rgba(0,177,79,.20);
      /* Brand palette (primary) */
      --accent:#00B14F;         /* Default */
      --accent-600:#00804A;     /* Bolder */
      --accent-700:#005339;     /* Boldest */
      --accent-soft:#B1EABA;    /* Soft */
      --accent-softest:#D9FCDE; /* Softest */
      --accent2:#FFD933;        /* Yellow default */
      --accent2-soft:#FFEC8F;   /* Yellow soft */
      --danger:#D42E1C;         /* Red default */
      /* Extra palette (from submitted chart) */
      --lime:#D3F035;
      --orange:#F76708;
      --teal:#17B5A6;
      --blue:#136FD8;
      --purple:#D194FF;
      --shadow: 0 14px 40px rgba(24,68,64,.10);
      --radius: 18px;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
      --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      /* Bright background using submitted palette (Mex-style) */
      background:
        radial-gradient(980px 760px at 14% 16%, rgba(0,177,79,.22), transparent 62%),
        radial-gradient(920px 720px at 86% 18%, rgba(255,217,51,.20), transparent 64%),
        radial-gradient(900px 700px at 82% 78%, rgba(23,181,166,.18), transparent 64%),
        radial-gradient(900px 700px at 34% 88%, rgba(209,148,255,.16), transparent 66%),
        radial-gradient(820px 640px at 60% 58%, rgba(19,111,216,.12), transparent 70%),
        linear-gradient(180deg, var(--bg0) 0%, var(--bg1) 56%, var(--bg2) 100%);
      overflow:hidden;
    }
    .wrap{
      height:100%;
      padding: calc(12px + var(--safe-top)) calc(14px + var(--safe-right)) calc(14px + var(--safe-bottom)) calc(14px + var(--safe-left));
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .topbar{ display:flex; flex-direction:column; gap:10px; }
    .progress{ display:flex; gap:6px; width:100%; align-items:center; }
    .seg{ position:relative; flex:1; height:4px; border-radius:999px; background: rgba(0,177,79,.18); overflow:hidden; }
    .seg > i{
      position:absolute; left:0; top:0; bottom:0;
      width:0%;
      background: linear-gradient(90deg, rgba(0,177,79,.95), rgba(0,177,79,.70));
      border-radius:999px;
      transform: translateZ(0);
    }
    .meta{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.78);
      border:1px solid rgba(0,177,79,.22);
    }
    .dot{
      width:8px; height:8px; border-radius:50%;
      background: var(--accent);
      box-shadow: 0 0 0 6px rgba(0,177,79,.18);
    }
    .brand{ font-weight: 800; letter-spacing: .2px; font-size: 13px; color: var(--accent-700); }
    .hint{ font-size: 12px; color: var(--muted2); user-select:none; white-space:nowrap; }
    .stage{
      position:relative;
      flex:1;
      border-radius: calc(var(--radius) + 8px);
      background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.88));
      border: 2px solid rgba(0,177,79,.26);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
    }
    .bgfx{
      position:absolute; inset:-2px;
      background:
        radial-gradient(620px 420px at 10% 18%, rgba(0,177,79,.18), transparent 62%),
        radial-gradient(600px 420px at 92% 22%, rgba(255,217,51,.16), transparent 64%),
        radial-gradient(620px 520px at 82% 110%, rgba(23,181,166,.14), transparent 66%),
        radial-gradient(620px 520px at 42% 118%, rgba(209,148,255,.12), transparent 70%);
      filter: saturate(1.2);
      opacity: .85;
      pointer-events:none;
    }
    .content{
      position:relative;
      width:100%;
      padding: 22px 18px;
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
      gap:14px;
    }
    .kicker{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius: 999px;
      background: rgba(255,249,192,.92);
      border: 1px solid rgba(255,217,51,.45);
      color: rgba(24,68,64,.92);
      font-size: 12px;
      letter-spacing:.2px;
    }
    .tag b{ color: var(--accent-600); }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius: 999px;
      background: rgba(217,252,222,.75);
      border: 1px solid rgba(0,177,79,.24);
      font-size: 12px;
      color: rgba(24,68,64,.88);
    }
    .title{ font-size: 26px; line-height: 1.15; margin:0; letter-spacing: -0.2px; }
    .title strong{ color: var(--accent-700); }
    .sub{ margin:0; font-size: 14px; line-height:1.5; color: var(--muted); white-space: pre-line; }
    .stat{
      padding: 14px 14px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.90));
      border:1px solid rgba(0,177,79,.22);
    }
    .stat .label{ font-size: 12px; letter-spacing:.3px; text-transform: uppercase; color: var(--muted2); }
    .stat .value{ margin-top:8px; font-size: 34px; line-height: 1.1; font-weight: 800; letter-spacing: -0.6px; }
    .value .hl{ color: var(--accent); }
    .value .hl2{ color: var(--accent2); }

    /* Compact multi stats (3 rows) */
    .multiStat{
      margin-top: 8px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .msRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      padding: 10px 10px;
      border-radius: 14px;
      background: rgba(217,252,222,.60);
      border: 1px solid rgba(0,177,79,.18);
    }
    .msLeft{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width: 0;
    }
    .msName{
      font-size: 12px;
      font-weight: 800;
      color: rgba(24,68,64,.92);
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .msDesc{
      font-size: 12px;
      line-height: 1.35;
      color: rgba(24,68,64,.72);
    }
    .msVal{
      flex: 0 0 auto;
      font-size: 20px;
      line-height: 1.1;
      font-weight: 900;
      letter-spacing: -0.3px;
      color: var(--accent-700);
      white-space:nowrap;
    }
    .msVal i{
      font-style: normal;
      color: var(--accent);
    }

    /* Persona (special) */
    .stage.is-persona{
      border-color: rgba(0,177,79,.34);
      box-shadow: 0 18px 52px rgba(0,177,79,.14), var(--shadow);
    }
    .stage.is-persona .bgfx{
      background:
        radial-gradient(760px 520px at 16% 18%, rgba(0,177,79,.22), transparent 62%),
        radial-gradient(720px 520px at 88% 22%, rgba(255,217,51,.18), transparent 66%),
        radial-gradient(820px 620px at 55% 118%, rgba(23,181,166,.14), transparent 70%);
      opacity: 1;
    }
    .personaWrap{
      position: relative;
      padding: 14px 14px 12px;
      border-radius: 16px;
      background:
        radial-gradient(420px 220px at 16% 0%, rgba(0,177,79,.14), transparent 62%),
        radial-gradient(420px 220px at 92% 10%, rgba(255,217,51,.14), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.98), rgba(255,255,255,.92));
      border: 1px solid rgba(0,177,79,.22);
      box-shadow: 0 14px 34px rgba(24,68,64,.10);
      overflow: hidden;
    }
    .personaWrap:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(240px 240px at 10% 20%, rgba(0,177,79,.18), transparent 60%),
        radial-gradient(220px 220px at 95% 35%, rgba(255,217,51,.14), transparent 62%);
      pointer-events:none;
      opacity:.95;
    }
    .personaTop{
      position: relative;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
    }
    .personaSeal{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(0,177,79,1);
      border: 1px solid rgba(0,128,74,.30);
      color: #fff;
      font-size: 12px;
      font-weight: 800;
      letter-spacing:.2px;
    }
    .personaSeal i{
      width: 18px;
      height: 18px;
      display:inline-grid;
      place-items:center;
      border-radius: 50%;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.12);
      font-style: normal;
    }
    .personaChip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(255,249,192,.95);
      border: 1px solid rgba(255,217,51,.40);
      color: rgba(24,68,64,.86);
      font-size: 12px;
      white-space:nowrap;
    }
    .personaName{
      position: relative;
      font-size: 34px;
      line-height: 1.05;
      font-weight: 900;
      letter-spacing: -0.8px;
      margin: 2px 0 8px;
      color: rgba(24,68,64,.98);
      text-shadow: 0 14px 34px rgba(0,177,79,.12);
    }
    .personaName .g{
      color: var(--accent);
    }
    .personaLine{
      position: relative;
      font-size: 13px;
      line-height: 1.45;
      color: rgba(24,68,64,.82);
    }
    .personaLine b{ color: var(--accent2); }
    .foot{ display:flex; align-items:flex-end; justify-content:space-between; gap:12px; margin-top: 6px; }
    .note{ font-size: 12px; color: var(--muted2); line-height:1.35; max-width: 80%; }
    .cta{
      font-size: 12px;
      font-weight: 700;
      color: #fff;
      padding:10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(0,128,74,.20);
      background: linear-gradient(180deg, rgba(0,177,79,1), rgba(0,128,74,1));
      user-select:none;
      white-space:nowrap;
    }
    .cta:active{ transform: scale(.98); }
    .tapzones{ position:absolute; inset:0; display:flex; z-index: 5; }
    .zone{ flex:1; cursor:pointer; }
    .zone:active{ background: rgba(255,255,255,.03); }
    .toast{
      position:absolute;
      left:12px;
      right:12px;
      bottom: calc(12px + var(--safe-bottom));
      z-index: 6;
      display:flex;
      justify-content:center;
      pointer-events:none;
      opacity:0;
      transform: translateY(8px);
      transition: opacity .22s ease, transform .22s ease;
    }
    .toast > div{
      max-width: 520px;
      padding:10px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.40);
      border:1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.88);
      font-size: 12px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .toast.show{ opacity:1; transform: translateY(0); }
    .fadeIn{ animation: fadeInUp .38s ease both; }
    @keyframes fadeInUp{
      from{ opacity:0; transform: translateY(10px); }
      to{ opacity:1; transform: translateY(0); }
    }
    @media (prefers-reduced-motion: reduce){
      .fadeIn{ animation:none; }
      .toast{ transition:none; }
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <div class="progress" id="progress"></div>
    <div class="meta">
      <div class="pill" aria-label="Dá»± Ã¡n">
        <span class="dot" aria-hidden="true"></span>
        <span class="brand">Rewind Äá»‘i tÃ¡c TÃ i xáº¿ 2025</span>
      </div>
      <div class="hint" id="hint">Cháº¡m Ä‘á»ƒ chuyá»ƒn â€¢ Nháº¥n giá»¯ Ä‘á»ƒ táº¡m dá»«ng</div>
    </div>
  </div>

  <div class="stage" id="stage" role="group" aria-label="Rewind story">
    <div class="bgfx" aria-hidden="true"></div>
    <div class="content" id="content"></div>
    <div class="tapzones" aria-hidden="true">
      <div class="zone" id="zonePrev" title="TrÆ°á»›c"></div>
      <div class="zone" id="zoneNext" title="Tiáº¿p"></div>
    </div>
    <div class="toast" id="toast"><div id="toastText"></div></div>
  </div>
</div>

<script th:inline="javascript">
  (function () {
    "use strict";

    var SLIDE_DURATION_MS = 6000;
    var HOLD_TO_PAUSE = true;

    // Data from server (safe defaults are set in controller)
    var DATA = {
      driver_name: /*[[${driverName}]]*/ "Äá»‘i tÃ¡c",
      total_gbrides: /*[[${totalGbRides}]]*/ "0",
      total_gfmrides: /*[[${totalGfmRides}]]*/ "0",
      total_gerides: /*[[${totalGeRides}]]*/ "0",
      total_5starsreviews: /*[[${total5StarsReviews}]]*/ "0",
      pct_5starsreviews: /*[[${pct5StarsReviews}]]*/ "0%",
      "%_5starsreviewsreview": /*[[${pct5StarsReviews}]]*/ "0%",
      badget_top1: /*[[${badgeTop1}]]*/ "Huy hiá»‡u",
      average_cr: /*[[${averageCr}]]*/ "0%"
    };

    function escapeHtml(str) {
      return String(str == null ? "" : str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    function tpl(html) {
      return String(html).replace(/\{\{\s*([^}]+?)\s*\}\}/g, function (_, key) {
        var k = String(key || "").trim();
        return escapeHtml(Object.prototype.hasOwnProperty.call(DATA, k) ? DATA[k] : "");
      });
    }

    // Slides content based on the text you provided
    var slides = [
      {
        key: "intro",
        tag: "Má»Ÿ Ä‘áº§u",
        title: "Äá»‘i tÃ¡c <strong>{{driver_name}}</strong> thÃ¢n máº¿n ğŸ’š",
        body:
          "NÄƒm 2025 vá»«a khÃ©p láº¡i, Äá»‘i tÃ¡c cÃ³ tÃ² mÃ² ráº±ng báº£n thÃ¢n Ä‘Ã£ hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o trong nÄƒm qua khÃ´ng? HÃ£y cÃ¹ng Grab nhÃ¬n láº¡i táº¡i Ä‘Ã¢y nhÃ©:\n\nğŸ‘‰ Sá»‘ lÆ°á»£ng chuyáº¿n xe Äá»‘i tÃ¡c hoÃ n thÃ nh theo loáº¡i dá»‹ch vá»¥:",
        statLabel: null,
        statValue: null,
        note: "Tip: Cháº¡m bÃªn pháº£i Ä‘á»ƒ next, bÃªn trÃ¡i Ä‘á»ƒ quay láº¡i.",
        cta: "Báº¯t Ä‘áº§u"
      },
      {
        key: "rides",
        tag: "Rewind 01",
        title: "Sá»‘ lÆ°á»£ng chuyáº¿n xe theo dá»‹ch vá»¥",
        body: "Trong nÄƒm 2025, Äá»‘i tÃ¡c Ä‘Ã£ hoÃ n thÃ nh:",
        statLabel: "Tá»•ng quan chuyáº¿n xe",
        statValue:
          "<div class='multiStat'>" +
            "<div class='msRow'>" +
              "<div class='msLeft'>" +
                "<div class='msName'>GrabBike ğŸ›µ</div>" +
                "<div class='msDesc'>giÃºp nhiá»u HÃ nh khÃ¡ch â€œÄ‘i Ä‘áº¿n nÆ¡i, vá» Ä‘áº¿n chá»‘nâ€.</div>" +
              "</div>" +
              "<div class='msVal'><i>" + "{{total_gbrides}}" + "</i> chuyáº¿n</div>" +
            "</div>" +
            "<div class='msRow' style='background: rgba(255,249,192,.85); border-color: rgba(255,217,51,.35)'>" +
              "<div class='msLeft'>" +
                "<div class='msName'>GrabFood & GrabMart ğŸœğŸ›’</div>" +
                "<div class='msDesc'>giÃºp nhiá»u NgÆ°á»i dÃ¹ng nháº­n nhá»¯ng bá»¯a Äƒn váº¹n trÃ²n, mÃ³n hÃ ng thiáº¿t yáº¿u.</div>" +
              "</div>" +
              "<div class='msVal'><i>" + "{{total_gfmrides}}" + "</i> chuyáº¿n</div>" +
            "</div>" +
            "<div class='msRow' style='background: rgba(235,250,255,.92); border-color: rgba(19,111,216,.18)'>" +
              "<div class='msLeft'>" +
                "<div class='msName'>GrabExpress ğŸ“¦</div>" +
                "<div class='msDesc'>Ä‘á»ƒ NgÆ°á»i dÃ¹ng nháº­n táº­n tay nhá»¯ng kiá»‡n hÃ ng ká»‹p thá»i vÃ  Ä‘Ãºng lÃºc.</div>" +
              "</div>" +
              "<div class='msVal'><i>" + "{{total_gerides}}" + "</i> chuyáº¿n</div>" +
            "</div>" +
          "</div>",
        note: "Má»™t nÄƒm bá»n bá»‰ vá»›i nhiá»u vai trÃ² khÃ¡c nhau.",
        cta: "Tiáº¿p"
      },
      {
        key: "persona",
        tag: "Rewind 02",
        title: "Äá»‘i tÃ¡c Ä‘Ã­ch thá»‹ lÃ â€¦",
        body: "Vá»›i táº§n suáº¥t váº­n hÃ nh nhÆ° váº­y, Ä‘Ã­ch thá»‹ Äá»‘i tÃ¡c chÃ­nh lÃ :",
        statLabel: "Danh xÆ°ng 2025",
        statValue:
          "<div class='personaWrap'>" +
            "<div class='personaTop'>" +
              "<span class='personaSeal'><i>âœ“</i> Rewind 2025</span>" +
              "<span class='personaChip'>ğŸ An toÃ n lÃ  sá»‘ 1</span>" +
            "</div>" +
            "<div class='personaName'><span class='g'>Äáº¡i sá»©</span> an toÃ n</div>" +
            "<div class='personaLine'>vÃ¬ mang láº¡i sá»± an tÃ¢m <b>trÃªn má»i náº»o Ä‘Æ°á»ng</b></div>" +
          "</div>",
        note: "Slide Ä‘áº·c biá»‡t cá»§a nÄƒm â€” xin Ä‘Æ°á»£c â€œÄ‘á»©ng hÃ¬nhâ€ 1 nhá»‹p cho danh hiá»‡u nÃ y.",
        cta: "Tiáº¿p"
      },
      {
        key: "rating_badge",
        tag: "Rewind 03",
        title: "5 sao & huy hiá»‡u â­",
        body: "NgoÃ i ra, Äá»‘i tÃ¡c Ä‘Ã£ â€œthu hoáº¡châ€ Ä‘Æ°á»£c:",
        statLabel: "Äiá»ƒm ná»•i báº­t",
        statValue:
          "<div class='multiStat'>" +
            "<div class='msRow'>" +
              "<div class='msLeft'>" +
                "<div class='msName'>ÄÃ¡nh giÃ¡ 5 sao</div>" +
                "<div class='msDesc'>chiáº¿m {{%_5starsreviewsreview}} trÃªn tá»•ng sá»‘ lÆ°á»£t Ä‘Ã¡nh giÃ¡ 5 sao.</div>" +
              "</div>" +
              "<div class='msVal'><i>" + "{{total_5starsreviews}}" + "</i></div>" +
            "</div>" +
            "<div class='msRow' style='background: rgba(255,255,255,.96)'>" +
              "<div class='msLeft'>" +
                "<div class='msName'>Huy hiá»‡u nháº­n nhiá»u nháº¥t</div>" +
                "<div class='msDesc'>ÄÃ¢y lÃ  loáº¡i huy hiá»‡u Äá»‘i tÃ¡c nháº­n Ä‘Æ°á»£c nhiá»u nháº¥t trong nÄƒm.</div>" +
              "</div>" +
              "<div class='msVal'><i>" + "{{badget_top1}}" + "</i></div>" +
            "</div>" +
          "</div>",
        note: "Giá»¯ phong Ä‘á»™ nÃ y Ä‘á»ƒ 2026 cÃ²n bá»©t tá»‘c hÆ¡n nhÃ©!",
        cta: "Tiáº¿p"
      },
      {
        key: "cr",
        tag: "Rewind 04",
        title: "Tá»· lá»‡ há»§y chuyáº¿n",
        body: "Tá»· lá»‡ há»§y chuyáº¿n trung bÃ¬nh trong nÄƒm 2025 cá»§a Äá»‘i tÃ¡c lÃ ",
        statLabel: "Average CR",
        statValue: "<span class='hl'>{{average_cr}}</span>",
        note: "HÃ£y tiáº¿p tá»¥c cáº£i thiá»‡n tá»· lá»‡ nháº­n nÃ y Ä‘á»ƒ nháº­n thÃªm nhiá»u cÆ¡ há»™i gia tÄƒng thu nháº­p trong nÄƒm 2026!",
        cta: "Tiáº¿p"
      },
      {
        key: "end",
        tag: "Káº¿t",
        title: "CÃ¡m Æ¡n Äá»‘i tÃ¡c <strong>{{driver_name}}</strong> ğŸ’š",
        body:
          "HÃ£y dÃ nh lá»i cÃ¡m Æ¡n Ä‘áº¿n báº£n thÃ¢n vÃ¬ Ä‘Ã£ khÃ´ng ngá»«ng cá»‘ gáº¯ng trong nÄƒm 2025. Giá» thÃ¬ hÃ£y chia sáº» thÃ nh tÃ­ch nÃ y Ä‘áº¿n cÃ¡c â€œchiáº¿n há»¯uâ€ Grab nhÃ©!\n\nMáº¿n chÃºc Äá»‘i tÃ¡c luÃ´n hoáº¡t Ä‘á»™ng hiá»‡u quáº£ vÃ  an toÃ n trÃªn má»i náº»o Ä‘Æ°á»ng ğŸ’š\n\nTrÃ¢n trá»ng,\nÄá»™i ngÅ© Grab",
        statLabel: "Khoe chiáº¿n tÃ­ch",
        statValue: "<span class='hl2'>KHOE CHIáº¾N TÃCH NGAY</span>",
        note: "Báº¡n cÃ³ thá»ƒ Ä‘Ã³ng story táº¡i Ä‘Ã¢y.",
        cta: "Xong"
      }
    ];

    // ===== State =====
    var idx = 0;
    var startedAt = Date.now();
    var paused = false;
    var pauseStartedAt = 0;
    var pausedAccum = 0;
    var rafId = 0;
    var toastT = 0;

    // ===== DOM =====
    var elProgress = document.getElementById("progress");
    var elContent = document.getElementById("content");
    var elStage = document.getElementById("stage");
    var elPrev = document.getElementById("zonePrev");
    var elNext = document.getElementById("zoneNext");
    var elToast = document.getElementById("toast");
    var elToastText = document.getElementById("toastText");

    // Build progress segments
    var segEls = [];
    (function buildProgress() {
      elProgress.innerHTML = "";
      segEls = [];
      for (var i = 0; i < slides.length; i++) {
        var seg = document.createElement("div");
        seg.className = "seg";
        var fill = document.createElement("i");
        seg.appendChild(fill);
        elProgress.appendChild(seg);
        segEls.push(fill);
      }
    })();

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function showToast(msg) {
      window.clearTimeout(toastT);
      elToastText.textContent = msg;
      elToast.classList.add("show");
      toastT = window.setTimeout(function () {
        elToast.classList.remove("show");
      }, 900);
    }

    function renderSlide(i) {
      var s = slides[i];
      if (s && s.key === "persona") elStage.classList.add("is-persona");
      else elStage.classList.remove("is-persona");
      var kickerHtml =
        "<div class='kicker fadeIn'>" +
        "<span class='tag'><span aria-hidden='true'>âœ¦</span> <b>" + escapeHtml(s.tag) + "</b></span>" +
        "<span class='badge'>2025</span>" +
        "</div>";

      var titleHtml = "<h1 class='title fadeIn' style='animation-delay:60ms'>" + tpl(s.title) + "</h1>";
      var bodyHtml = s.body ? ("<p class='sub fadeIn' style='animation-delay:110ms'>" + tpl(s.body) + "</p>") : "";

      var statHtml = "";
      if (s.statLabel && s.statValue) {
        statHtml =
          "<div class='stat fadeIn' style='animation-delay:160ms'>" +
          "<div class='label'>" + escapeHtml(s.statLabel) + "</div>" +
          "<div class='value'>" + tpl(s.statValue) + "</div>" +
          "</div>";
      }

      var footHtml =
        "<div class='foot fadeIn' style='animation-delay:210ms'>" +
        "<div class='note'>" + tpl(s.note || "") + "</div>" +
        "<div class='cta' id='ctaBtn'>" + escapeHtml(s.cta || "Tiáº¿p") + "</div>" +
        "</div>";

      elContent.innerHTML = kickerHtml + "<div>" + titleHtml + bodyHtml + "</div>" + statHtml + footHtml;

      var ctaBtn = document.getElementById("ctaBtn");
      if (ctaBtn) {
        ctaBtn.addEventListener("click", function (e) {
          e.preventDefault();
          next();
        }, { passive: true });
      }
    }

    function resetTimer() {
      startedAt = Date.now();
      pausedAccum = 0;
      paused = false;
      pauseStartedAt = 0;
    }

    function setIndex(nextIdx, reason) {
      var newIdx = clamp(nextIdx, 0, slides.length - 1);
      if (newIdx === idx) {
        if (reason === "next" && idx === slides.length - 1) showToast("ÄÃ£ tá»›i slide cuá»‘i");
        if (reason === "prev" && idx === 0) showToast("Äang á»Ÿ slide Ä‘áº§u");
        return;
      }
      idx = newIdx;
      resetTimer();
      renderSlide(idx);
    }

    function next(){ setIndex(idx + 1, "next"); }
    function prev(){ setIndex(idx - 1, "prev"); }

    function pause() {
      if (!HOLD_TO_PAUSE) return;
      if (paused) return;
      paused = true;
      pauseStartedAt = Date.now();
    }

    function resume() {
      if (!HOLD_TO_PAUSE) return;
      if (!paused) return;
      paused = false;
      pausedAccum += (Date.now() - pauseStartedAt);
      pauseStartedAt = 0;
    }

    function tick() {
      for (var i = 0; i < segEls.length; i++) {
        if (i < idx) segEls[i].style.width = "100%";
        else if (i > idx) segEls[i].style.width = "0%";
      }

      var now = Date.now();
      var effectiveNow = paused ? pauseStartedAt : now;
      var elapsed = effectiveNow - startedAt - pausedAccum;
      var p = clamp(elapsed / SLIDE_DURATION_MS, 0, 1);
      segEls[idx].style.width = (p * 100).toFixed(2) + "%";

      if (!paused && p >= 1) {
        if (idx < slides.length - 1) setIndex(idx + 1, "next");
      }

      rafId = window.requestAnimationFrame(tick);
    }

    // Tap left/right
    elPrev.addEventListener("click", function (e) { e.preventDefault(); prev(); }, { passive: false });
    elNext.addEventListener("click", function (e) { e.preventDefault(); next(); }, { passive: false });

    // Hold to pause
    function bindHold(el){
      el.addEventListener("touchstart", function(){ pause(); }, { passive: true });
      el.addEventListener("touchend", function(){ resume(); }, { passive: true });
      el.addEventListener("touchcancel", function(){ resume(); }, { passive: true });
      el.addEventListener("mousedown", function(){ pause(); });
      el.addEventListener("mouseup", function(){ resume(); });
      el.addEventListener("mouseleave", function(){ resume(); });
    }
    bindHold(elStage);

    // Prevent double-tap zoom on iOS webviews
    var lastTouch = 0;
    document.addEventListener("touchend", function (e) {
      var now = Date.now();
      if (now - lastTouch <= 250) e.preventDefault();
      lastTouch = now;
    }, { passive: false });

    // Keyboard (debug)
    document.addEventListener("keydown", function (e) {
      if (e.key === "ArrowRight") next();
      if (e.key === "ArrowLeft") prev();
      if (e.key === " ") { paused ? resume() : pause(); }
    });

    renderSlide(idx);
    tick();
  })();
</script>
</body>
</html>

