<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="format-detection" content="telephone=no,date=no,address=no,email=no"/>
  <meta name="robots" content="noindex,nofollow"/>
  <title>Rewind ƒê·ªëi t√°c Nh√† h√†ng 2025</title>
  <style>
    :root{
      /* Light theme (Mex-style) */
      --bg0:#D9FCDE;  /* Softest green */
      --bg1:#EBFAFF;  /* Softest blue */
      --bg2:#FBF0FF;  /* Softest purple */
      --card:rgba(255,255,255,.92);
      --card2:rgba(255,255,255,.78);
      --text:#184440;   /* deep green/ink */
      --muted:rgba(24,68,64,.74);
      --muted2:rgba(24,68,64,.58);
      --line:rgba(0,177,79,.20);
      /* Brand palette (primary) */
      --accent:#00B14F;         /* Default */
      --accent-600:#00804A;     /* Bolder */
      --accent-700:#005339;     /* Boldest */
      --accent-soft:#B1EABA;    /* Soft */
      --accent-softest:#D9FCDE; /* Softest */
      --accent2:#FFD933;        /* Yellow default */
      --accent2-soft:#FFEC8F;   /* Yellow soft */
      --danger:#D42E1C;         /* Red default */
      /* Extra palette (from submitted chart) */
      --lime:#D3F035;
      --orange:#F76708;
      --teal:#17B5A6;
      --blue:#136FD8;
      --purple:#D194FF;
      --shadow: 0 14px 40px rgba(24,68,64,.10);
      --radius: 18px;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
      --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      /* Bright background using submitted palette (Mex-style) */
      background:
        radial-gradient(980px 760px at 14% 16%, rgba(0,177,79,.22), transparent 62%),
        radial-gradient(920px 720px at 86% 18%, rgba(255,217,51,.20), transparent 64%),
        radial-gradient(900px 700px at 82% 78%, rgba(23,181,166,.18), transparent 64%),
        radial-gradient(900px 700px at 34% 88%, rgba(209,148,255,.16), transparent 66%),
        radial-gradient(820px 640px at 60% 58%, rgba(19,111,216,.12), transparent 70%),
        linear-gradient(180deg, var(--bg0) 0%, var(--bg1) 56%, var(--bg2) 100%);
      overflow:hidden;
    }
    .wrap{
      height:100%;
      padding: calc(12px + var(--safe-top)) calc(14px + var(--safe-right)) calc(14px + var(--safe-bottom)) calc(14px + var(--safe-left));
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .topbar{ display:flex; flex-direction:column; gap:10px; }
    .progress{ display:flex; gap:6px; width:100%; align-items:center; }
    .seg{ position:relative; flex:1; height:4px; border-radius:999px; background: rgba(0,177,79,.18); overflow:hidden; }
    .seg > i{
      position:absolute; left:0; top:0; bottom:0;
      width:0%;
      background: linear-gradient(90deg, rgba(0,177,79,.95), rgba(0,177,79,.70));
      border-radius:999px;
      transform: translateZ(0);
    }
    .meta{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.78);
      border:1px solid rgba(0,177,79,.22);
    }
    .dot{
      width:8px; height:8px; border-radius:50%;
      background: var(--accent);
      box-shadow: 0 0 0 6px rgba(0,177,79,.18);
    }
    .brand{ font-weight: 800; letter-spacing: .2px; font-size: 13px; color: var(--accent-700); }
    .hint{ font-size: 12px; color: var(--muted2); user-select:none; white-space:nowrap; }
    .stage{
      position:relative;
      flex:1;
      border-radius: calc(var(--radius) + 8px);
      background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.88));
      border: 2px solid rgba(0,177,79,.26);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
    }
    .bgfx{
      position:absolute; inset:-2px;
      background:
        radial-gradient(620px 420px at 10% 18%, rgba(0,177,79,.18), transparent 62%),
        radial-gradient(600px 420px at 92% 22%, rgba(255,217,51,.16), transparent 64%),
        radial-gradient(620px 520px at 82% 110%, rgba(23,181,166,.14), transparent 66%),
        radial-gradient(620px 520px at 42% 118%, rgba(209,148,255,.12), transparent 70%);
      filter: saturate(1.2);
      opacity: .85;
      pointer-events:none;
    }
    .content{
      position:relative;
      width:100%;
      padding: 22px 18px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      gap:14px;
    }
    .kicker{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius: 999px;
      background: rgba(255,249,192,.92);
      border: 1px solid rgba(255,217,51,.45);
      color: rgba(24,68,64,.92);
      font-size: 12px;
      letter-spacing:.2px;
    }
    .tag b{ color: var(--accent-600); }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius: 999px;
      background: rgba(217,252,222,.75);
      border: 1px solid rgba(0,177,79,.24);
      font-size: 12px;
      color: rgba(24,68,64,.88);
    }
    .title{ font-size: 26px; line-height: 1.15; margin:0; letter-spacing: -0.2px; }
    .title strong{ color: var(--accent-700); }
    .sub{ margin:0; font-size: 14px; line-height:1.5; color: var(--muted); white-space: pre-line; }
    .stat{
      padding: 14px 14px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.90));
      border:1px solid rgba(0,177,79,.22);
    }
    .stat .label{ font-size: 12px; letter-spacing:.3px; text-transform: uppercase; color: var(--muted2); }
    .stat .value{ margin-top:8px; font-size: 34px; line-height: 1.1; font-weight: 800; letter-spacing: -0.6px; }
    .value .hl{ color: var(--accent); }
    .value .hl2{ color: var(--accent2); }
    .foot{ display:flex; align-items:flex-end; justify-content:space-between; gap:12px; }
    .note{ font-size: 12px; color: var(--muted2); line-height:1.35; max-width: 80%; }
    .cta{
      font-size: 12px;
      font-weight: 700;
      color: #fff;
      padding:10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(0,128,74,.20);
      background: linear-gradient(180deg, rgba(0,177,79,1), rgba(0,128,74,1));
      user-select:none;
      white-space:nowrap;
    }
    .cta:active{ transform: scale(.98); }
    .tapzones{ position:absolute; inset:0; display:flex; z-index: 5; }
    .zone{ flex:1; cursor:pointer; }
    .zone:active{ background: rgba(255,255,255,.03); }
    .toast{
      position:absolute;
      left:12px;
      right:12px;
      bottom: calc(12px + var(--safe-bottom));
      z-index: 6;
      display:flex;
      justify-content:center;
      pointer-events:none;
      opacity:0;
      transform: translateY(8px);
      transition: opacity .22s ease, transform .22s ease;
    }
    .toast > div{
      max-width: 520px;
      padding:10px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.40);
      border:1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.88);
      font-size: 12px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .toast.show{ opacity:1; transform: translateY(0); }
    .fadeIn{ animation: fadeInUp .38s ease both; }
    @keyframes fadeInUp{
      from{ opacity:0; transform: translateY(10px); }
      to{ opacity:1; transform: translateY(0); }
    }
    @media (prefers-reduced-motion: reduce){
      .fadeIn{ animation:none; }
      .toast{ transition:none; }
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <div class="progress" id="progress"></div>
    <div class="meta">
      <div class="pill" aria-label="D·ª± √°n">
        <span class="dot" aria-hidden="true"></span>
        <span class="brand">Rewind ƒê·ªëi t√°c Nh√† h√†ng 2025</span>
      </div>
      <div class="hint" id="hint">Ch·∫°m ƒë·ªÉ chuy·ªÉn ‚Ä¢ Nh·∫•n gi·ªØ ƒë·ªÉ t·∫°m d·ª´ng</div>
    </div>
  </div>

  <div class="stage" id="stage" role="group" aria-label="Rewind story">
    <div class="bgfx" aria-hidden="true"></div>
    <div class="content" id="content"></div>
    <div class="tapzones" aria-hidden="true">
      <div class="zone" id="zonePrev" title="Tr∆∞·ªõc"></div>
      <div class="zone" id="zoneNext" title="Ti·∫øp"></div>
    </div>
    <div class="toast" id="toast"><div id="toastText"></div></div>
  </div>
</div>

<script th:inline="javascript">
  (function () {
    "use strict";

    var SLIDE_DURATION_MS = 6000;
    var HOLD_TO_PAUSE = true;

    var DATA = {
      merchant_name: /*[[${merchantName}]]*/ "C·ª≠a h√†ng c·ªßa b·∫°n",
      province: /*[[${province}]]*/ "Vi·ªát Nam",
      item_quantity: /*[[${itemQuantity}]]*/ "0",
      item_name: /*[[${itemName}]]*/ "S·∫£n ph·∫©m b√°n ch·∫°y",
      campaign_name: /*[[${campaignName}]]*/ "Chi·∫øn d·ªãch n·ªïi b·∫≠t",
      fastest_growth_month: /*[[${fastestGrowthMonth}]]*/ "Th√°ng 1",
      time: /*[[${peakTime}]]*/ "19:00 - 20:00"
    };

    function escapeHtml(str) {
      return String(str == null ? "" : str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    function tpl(html) {
      return String(html).replace(/\{\{\s*([a-zA-Z0-9_]+)\s*\}\}/g, function (_, key) {
        return escapeHtml(DATA[key]);
      });
    }

    var slides = [
      {
        key: "intro",
        tag: "M·ªü ƒë·∫ßu",
        title: "C·ª≠a h√†ng <strong>{{merchant_name}}</strong> ∆°i,",
        body:
          "2025 l√† m·ªôt nƒÉm b·∫≠n r·ªôn t·∫°i C·ª≠a h√†ng ƒë·∫•y! M·ªói c·ªôt m·ªëc ƒë·ªÅu k·ªÉ l·∫°i h√†nh tr√¨nh r·∫•t ri√™ng, ƒë·ªÅu l√† d·∫•u ·∫•n c·ªßa s·ª± b·ªÅn b·ªâ v√† tƒÉng tr∆∞·ªüng kh√¥ng ng·ª´ng trong nƒÉm.\n\nC√πng nh√¨n l·∫°i m·ªôt nƒÉm ƒë√°ng nh·ªõ nh√© üëá",
        statLabel: null,
        statValue: null,
        note: "Tip: Ch·∫°m b√™n ph·∫£i ƒë·ªÉ next, b√™n tr√°i ƒë·ªÉ quay l·∫°i.",
        cta: "B·∫Øt ƒë·∫ßu"
      },
      {
        key: "naming",
        tag: "Danh x∆∞ng",
        title: "C·ª≠a h√†ng x·ªãn m·ªõi nh·∫≠p h·ªôi",
        body: "t·∫°i <strong>{{province}}</strong>",
        statLabel: "Merchant naming",
        statValue: "<span class='hl2'>{{province}}</span>",
        note: "Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Rewind 2025.",
        cta: "Ti·∫øp"
      },
      {
        key: "total_items",
        tag: "Rewind 01",
        title: "T·ªïng s·ªë s·∫£n ph·∫©m b√°n ra trong nƒÉm",
        body: "ƒê√£ c√≥",
        statLabel: "S·∫£n ph·∫©m ƒë√£ b√°n",
        statValue: "<span class='hl'>{{item_quantity}}</span> s·∫£n ph·∫©m",
        note: "t·∫°i C·ª≠a h√†ng ƒë√£ ƒë∆∞·ª£c trao ƒë·∫øn Ng∆∞·ªùi d√πng trong nƒÉm qua",
        cta: "Ti·∫øp"
      },
      {
        key: "best_item",
        tag: "Rewind 02",
        title: "\"N√†ng th∆°\" c·ªßa C·ª≠a h√†ng",
        body: "",
        statLabel: "S·∫£n ph·∫©m b√°n ch·∫°y nh·∫•t",
        statValue: "<span class='hl2'>{{item_name}}</span>",
        note: "ch√≠nh l√† s·∫£n ph·∫©m g√¢y th∆∞∆°ng nh·ªõ nh·∫•t v√† ƒë∆∞·ª£c Ng∆∞·ªùi d√πng ƒë·∫∑t nhi·ªÅu nh·∫•t nƒÉm qua",
        cta: "Ti·∫øp"
      },
      {
        key: "best_campaign",
        tag: "Rewind 03",
        title: "Chi·∫øn d·ªãch mang l·∫°i nhi·ªÅu ƒë∆°n nh·∫•t",
        body: "Chi·∫øn d·ªãch",
        statLabel: "Top campaign",
        statValue: "<span class='hl'>{{campaign_name}}</span>",
        note: "ƒë√£ g√≥p 1 ph·∫ßn gi√∫p C·ª≠a h√†ng \"l√™n h∆∞∆°ng\" v√† thu h√∫t v·ªÅ nhi·ªÅu ƒë∆°n h√†ng",
        cta: "Ti·∫øp"
      },
      {
        key: "fastest_month",
        tag: "Rewind 04",
        title: "Th√°ng tƒÉng tr∆∞·ªüng nhanh nh·∫•t trong nƒÉm",
        body: "Th√°ng b·ª©t t·ªëc c·ªßa C·ª≠a h√†ng l√†",
        statLabel: "Th√°ng tƒÉng tr∆∞·ªüng nhanh nh·∫•t",
        statValue: "<span class='hl2'>{{fastest_growth_month}}</span>",
        note: "Gi·ªØ nh·ªãp tƒÉng tr∆∞·ªüng n√†y ƒë·ªÉ 2026 c√≤n r·ª±c r·ª° h∆°n nh√©!",
        cta: "Ti·∫øp"
      },
      {
        key: "peak_time",
        tag: "Rewind 05",
        title: "Khung gi·ªù nhi·ªÅu ƒë∆°n nh·∫•t",
        body: "Gi·ªù v√†ng C·ª≠a h√†ng n·ªï ƒë∆°n l√†",
        statLabel: "Gi·ªù v√†ng",
        statValue: "<span class='hl'>{{time}}</span>",
        note: "ƒê·ªëi t√°c h√£y ghi s·ªï l·∫°i khung gi·ªù n√†y ƒë·ªÉ c√≥ chu·∫©n b·ªã v·∫≠n h√†nh th·∫≠t t·ªët v√† ƒë√≥n ƒë∆°n v·ªÅ nh√©!",
        cta: "Ti·∫øp"
      },
      {
        key: "end",
        tag: "K·∫øt",
        title: "C·∫£m ∆°n <strong>{{merchant_name}}</strong>!",
        body:
          "M·ªôt nƒÉm b·ªÅn b·ªâ ƒë√£ qua ‚Äî v√† h√†nh tr√¨nh v·∫´n ƒëang ti·∫øp t·ª•c.\n\nCh√∫c C·ª≠a h√†ng 2026 b√πng n·ªï ƒë∆°n ƒë·ªÅu, v·∫≠n h√†nh m∆∞·ª£t v√† tƒÉng tr∆∞·ªüng m·∫°nh.",
        statLabel: "H·∫πn g·∫∑p l·∫°i",
        statValue: "<span class='hl2'>Rewind 2026</span>",
        note: "B·∫°n c√≥ th·ªÉ ƒë√≥ng story t·∫°i ƒë√¢y.",
        cta: "Xong"
      }
    ];

    // ===== State =====
    var idx = 0;
    var startedAt = Date.now();
    var paused = false;
    var pauseStartedAt = 0;
    var pausedAccum = 0;
    var rafId = 0;
    var toastT = 0;

    // ===== DOM =====
    var elProgress = document.getElementById("progress");
    var elContent = document.getElementById("content");
    var elStage = document.getElementById("stage");
    var elPrev = document.getElementById("zonePrev");
    var elNext = document.getElementById("zoneNext");
    var elToast = document.getElementById("toast");
    var elToastText = document.getElementById("toastText");

    // Build progress segments
    var segEls = [];
    (function buildProgress() {
      elProgress.innerHTML = "";
      segEls = [];
      for (var i = 0; i < slides.length; i++) {
        var seg = document.createElement("div");
        seg.className = "seg";
        var fill = document.createElement("i");
        seg.appendChild(fill);
        elProgress.appendChild(seg);
        segEls.push(fill);
      }
    })();

    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function showToast(msg) {
      window.clearTimeout(toastT);
      elToastText.textContent = msg;
      elToast.classList.add("show");
      toastT = window.setTimeout(function () {
        elToast.classList.remove("show");
      }, 900);
    }

    function renderSlide(i) {
      var s = slides[i];
      var kickerHtml =
        "<div class='kicker fadeIn'>" +
        "<span class='tag'><span aria-hidden='true'>‚ú¶</span> <b>" + escapeHtml(s.tag) + "</b></span>" +
        "<span class='badge'>2025</span>" +
        "</div>";

      var titleHtml = "<h1 class='title fadeIn' style='animation-delay:60ms'>" + tpl(s.title) + "</h1>";
      var bodyHtml = s.body ? ("<p class='sub fadeIn' style='animation-delay:110ms'>" + tpl(s.body) + "</p>") : "";

      var statHtml = "";
      if (s.statLabel && s.statValue) {
        statHtml =
          "<div class='stat fadeIn' style='animation-delay:160ms'>" +
          "<div class='label'>" + escapeHtml(s.statLabel) + "</div>" +
          "<div class='value'>" + tpl(s.statValue) + "</div>" +
          "</div>";
      }

      var footHtml =
        "<div class='foot fadeIn' style='animation-delay:210ms'>" +
        "<div class='note'>" + tpl(s.note || "") + "</div>" +
        "<div class='cta' id='ctaBtn'>" + escapeHtml(s.cta || "Ti·∫øp") + "</div>" +
        "</div>";

      elContent.innerHTML = kickerHtml + "<div>" + titleHtml + bodyHtml + "</div>" + statHtml + footHtml;

      var ctaBtn = document.getElementById("ctaBtn");
      if (ctaBtn) {
        ctaBtn.addEventListener("click", function (e) {
          e.preventDefault();
          next();
        }, { passive: true });
      }
    }

    function resetTimer() {
      startedAt = Date.now();
      pausedAccum = 0;
      paused = false;
      pauseStartedAt = 0;
    }

    function setIndex(nextIdx, reason) {
      var newIdx = clamp(nextIdx, 0, slides.length - 1);
      if (newIdx === idx) {
        if (reason === "next" && idx === slides.length - 1) showToast("ƒê√£ t·ªõi slide cu·ªëi");
        if (reason === "prev" && idx === 0) showToast("ƒêang ·ªü slide ƒë·∫ßu");
        return;
      }
      idx = newIdx;
      resetTimer();
      renderSlide(idx);
    }

    function next(){ setIndex(idx + 1, "next"); }
    function prev(){ setIndex(idx - 1, "prev"); }

    function pause() {
      if (!HOLD_TO_PAUSE) return;
      if (paused) return;
      paused = true;
      pauseStartedAt = Date.now();
    }

    function resume() {
      if (!HOLD_TO_PAUSE) return;
      if (!paused) return;
      paused = false;
      pausedAccum += (Date.now() - pauseStartedAt);
      pauseStartedAt = 0;
    }

    function tick() {
      for (var i = 0; i < segEls.length; i++) {
        if (i < idx) segEls[i].style.width = "100%";
        else if (i > idx) segEls[i].style.width = "0%";
      }

      var now = Date.now();
      var effectiveNow = paused ? pauseStartedAt : now;
      var elapsed = effectiveNow - startedAt - pausedAccum;
      var p = clamp(elapsed / SLIDE_DURATION_MS, 0, 1);
      segEls[idx].style.width = (p * 100).toFixed(2) + "%";

      if (!paused && p >= 1) {
        if (idx < slides.length - 1) setIndex(idx + 1, "next");
      }

      rafId = window.requestAnimationFrame(tick);
    }

    // Tap left/right
    elPrev.addEventListener("click", function (e) { e.preventDefault(); prev(); }, { passive: false });
    elNext.addEventListener("click", function (e) { e.preventDefault(); next(); }, { passive: false });

    // Hold to pause
    function bindHold(el){
      el.addEventListener("touchstart", function(){ pause(); }, { passive: true });
      el.addEventListener("touchend", function(){ resume(); }, { passive: true });
      el.addEventListener("touchcancel", function(){ resume(); }, { passive: true });
      el.addEventListener("mousedown", function(){ pause(); });
      el.addEventListener("mouseup", function(){ resume(); });
      el.addEventListener("mouseleave", function(){ resume(); });
    }
    bindHold(elStage);

    // Prevent double-tap zoom on iOS webviews
    var lastTouch = 0;
    document.addEventListener("touchend", function (e) {
      var now = Date.now();
      if (now - lastTouch <= 250) e.preventDefault();
      lastTouch = now;
    }, { passive: false });

    // Keyboard (debug)
    document.addEventListener("keydown", function (e) {
      if (e.key === "ArrowRight") next();
      if (e.key === "ArrowLeft") prev();
      if (e.key === " ") { paused ? resume() : pause(); }
    });

    renderSlide(idx);
    tick();
  })();
</script>
</body>
</html>

