<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!-- Profile Modal Fragment - Wrapper to include all modals -->
<th:block th:fragment="profileModal">
    <div aria-hidden="true" aria-labelledby="profileModalLabel" class="modal fade text-left" id="profileModal"
         role="dialog" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="profileModalLabel">
                        <i data-feather="user"></i> Profile Settings
                    </h5>
                    <button aria-label="Close" class="close rounded-pill" data-bs-dismiss="modal" type="button">
                        <i data-feather="x"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Nav Tabs -->
                    <ul class="nav nav-tabs" id="profileTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <a aria-controls="tab-profile" aria-selected="true" class="nav-link active" data-bs-toggle="tab"
                               href="#tab-profile" id="tab-profile-link" role="tab">
                                <i data-feather="user" width="16"></i> Profile
                            </a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a aria-controls="tab-password" aria-selected="false" class="nav-link" data-bs-toggle="tab"
                               href="#tab-password" id="tab-password-link" role="tab">
                                <i data-feather="lock" width="16"></i> Password
                            </a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a aria-controls="tab-passkey" aria-selected="false" class="nav-link" data-bs-toggle="tab"
                               href="#tab-passkey" id="tab-passkey-link" role="tab">
                                <i data-feather="key" width="16"></i> Passkeys
                            </a>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content pt-3" id="profileTabsContent">
                        <!-- Profile Tab -->
                        <div aria-labelledby="tab-profile-link" class="tab-pane fade show active" id="tab-profile"
                             role="tabpanel">
                            <form id="profileForm">
                                <!-- Avatar Section -->
                                <div class="text-center mb-4">
                                    <div class="avatar avatar-xl mb-3" style="width: 100px; height: 100px;">
                                        <img alt="Avatar" class="rounded-circle"
                                             id="avatarPreview" style="width: 100%; height: 100%; object-fit: cover;"
                                             th:src="@{/voler/images/avatar/avatar-s-1.png}">
                                    </div>
                                    <div>
                                        <input accept="image/*" class="d-none" id="avatarInput" type="file">
                                        <button class="btn btn-sm btn-outline-primary" onclick="document.getElementById('avatarInput').click()"
                                                type="button">
                                            <i data-feather="upload" width="14"></i> Change Avatar
                                        </button>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="profileEmail">Email</label>
                                            <input class="form-control" id="profileEmail" readonly type="email">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="profileUsername">Username</label>
                                            <input class="form-control" id="profileUsername" placeholder="Username"
                                                   type="text">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="profileFirstName">First Name</label>
                                            <input class="form-control" id="profileFirstName" placeholder="First Name"
                                                   type="text">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="profileLastName">Last Name</label>
                                            <input class="form-control" id="profileLastName" placeholder="Last Name"
                                                   type="text">
                                        </div>
                                    </div>
                                </div>

                                <div class="text-end mt-3">
                                    <button class="btn btn-light-secondary" data-bs-dismiss="modal" type="button">
                                        Cancel
                                    </button>
                                    <button class="btn btn-primary ms-1" id="saveProfileBtn" type="button">
                                        <i data-feather="save" width="14"></i> Save Changes
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Password Tab -->
                        <div aria-labelledby="tab-password-link" class="tab-pane fade" id="tab-password"
                             role="tabpanel">
                            <form id="passwordForm">
                                <div class="form-group">
                                    <label for="currentPassword">Current Password</label>
                                    <input class="form-control" id="currentPassword" placeholder="Enter current password"
                                           type="password">
                                </div>

                                <div class="form-group">
                                    <label for="newPassword">New Password</label>
                                    <input class="form-control" id="newPassword" placeholder="Enter new password"
                                           type="password">
                                    <small class="text-muted">Minimum 8 characters</small>
                                </div>

                                <div class="form-group">
                                    <label for="confirmPassword">Confirm New Password</label>
                                    <input class="form-control" id="confirmPassword" placeholder="Confirm new password"
                                           type="password">
                                </div>

                                <div class="text-end mt-3">
                                    <button class="btn btn-light-secondary" data-bs-dismiss="modal" type="button">
                                        Cancel
                                    </button>
                                    <button class="btn btn-primary ms-1" id="changePasswordBtn" type="button">
                                        <i data-feather="lock" width="14"></i> Change Password
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Passkey Tab -->
                        <div aria-labelledby="tab-passkey-link" class="tab-pane fade" id="tab-passkey" role="tabpanel">
                            <!-- WebAuthn Not Supported Alert -->
                            <div class="alert alert-warning d-none" id="passkeyNotSupported">
                                <i data-feather="alert-triangle" width="16"></i>
                                <strong>Passkeys not supported</strong> in this browser. Please use a modern browser.
                            </div>

                            <!-- Info Box -->
                            <div class="alert alert-light-info mb-3">
                                <i data-feather="info" width="16"></i>
                                <strong>What is a Passkey?</strong> Passkeys use biometric authentication (fingerprint,
                                face) for secure, passwordless login.
                            </div>

                            <!-- Add Passkey Button -->
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0">Your Passkeys</h6>
                                <button class="btn btn-sm btn-primary" id="addPasskeyBtn" type="button">
                                    <i data-feather="plus" width="14"></i> Add Passkey
                                </button>
                            </div>

                            <!-- Loading State -->
                            <div class="text-center py-4" id="passkeyLoading">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2 text-muted">Loading passkeys...</p>
                            </div>

                            <!-- Empty State -->
                            <div class="text-center py-4 d-none" id="passkeyEmpty">
                                <i class="text-muted mb-2" data-feather="key" width="48"></i>
                                <p class="text-muted">No passkeys registered yet.</p>
                            </div>

                            <!-- Passkeys List -->
                            <div class="list-group" id="passkeyList">
                                <!-- Passkey items will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Passkey Modal (nested) -->
    <div class="modal fade" data-bs-backdrop="static" id="addPasskeyModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i data-feather="key"></i> Add New Passkey</h5>
                    <button class="close rounded-pill" data-bs-dismiss="modal" type="button">
                        <i data-feather="x"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Detected Device Info -->
                    <div class="alert alert-light-info mb-3" id="detectedDeviceInfo">
                        <div class="d-flex align-items-center">
                            <i class="me-2" data-feather="monitor" id="detectedDeviceIcon"></i>
                            <div>
                                <small class="text-muted">Detected device:</small>
                                <div class="fw-bold" id="detectedDeviceName">Detecting...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Select Suggestions -->
                    <div class="form-group mb-3">
                        <label class="form-label">Quick Select</label>
                        <div class="d-flex flex-wrap" id="deviceSuggestions" style="gap: 0.5rem;">
                            <!-- Will be populated by JS -->
                        </div>
                    </div>

                    <!-- Manual Input -->
                    <div class="form-group">
                        <label for="passkeyDeviceName">Or enter custom name</label>
                        <input class="form-control" id="passkeyDeviceName" placeholder="e.g., Work Laptop, Personal Phone"
                               type="text">
                        <small class="text-muted">A friendly name to identify this passkey</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-light-secondary" data-bs-dismiss="modal" type="button">Cancel</button>
                    <button class="btn btn-primary" id="confirmAddPasskeyBtn" type="button">
                        <i data-feather="fingerprint" width="14"></i> Register Passkey
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Rename Passkey Modal -->
    <div class="modal fade" data-bs-backdrop="static" id="renamePasskeyModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i data-feather="edit"></i> Rename Passkey</h5>
                    <button class="close rounded-pill" data-bs-dismiss="modal" type="button">
                        <i data-feather="x"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="newPasskeyName">New Device Name</label>
                        <input class="form-control" id="newPasskeyName" placeholder="Enter new name" type="text">
                    </div>
                    <input id="renamePasskeyId" type="hidden">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-light-secondary" data-bs-dismiss="modal" type="button">Cancel</button>
                    <button class="btn btn-primary" id="confirmRenamePasskeyBtn" type="button">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Passkey Modal -->
    <div class="modal fade" data-bs-backdrop="static" id="deletePasskeyModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-danger"><i data-feather="trash-2"></i> Delete Passkey</h5>
                    <button class="close rounded-pill" data-bs-dismiss="modal" type="button">
                        <i data-feather="x"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this passkey?</p>
                    <p class="text-muted mb-0"><strong>Device:</strong> <span id="deletePasskeyName"></span></p>
                    <input id="deletePasskeyId" type="hidden">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-light-secondary" data-bs-dismiss="modal" type="button">Cancel</button>
                    <button class="btn btn-danger" id="confirmDeletePasskeyBtn" type="button">Delete</button>
                </div>
            </div>
        </div>
    </div>
</th:block>
</html>

